/******************************************************************************
 * Includes
 *******************************************************************************/
#include "HornControl.h"
#include "IO.h"
#include "MCU_dbc.h"
#include <stdint.h>

/******************************************************************************
 * Constants
 *******************************************************************************/

/******************************************************************************
 * Macros
 *******************************************************************************/
#define HORN_MAX_TIME 50 // x100ms = 5 seconds
/******************************************************************************
 * Configuration
 *******************************************************************************/

/******************************************************************************
 * Typedefs
 *******************************************************************************/

/******************************************************************************
 * Variable Declarations
 *******************************************************************************/

/******************************************************************************
 * Function Prototypes
 *******************************************************************************/

/******************************************************************************
 * Function Definitions
 *******************************************************************************/

void HornControl_Init(void) {
    IO_SET_HORN_EN(LOW);
}

void HornControl_Run_10ms(void) {

    static uint8_t counter = 0;
    if (IO_GET_HORN_SWITCH_IN()) {
        if (counter < HORN_MAX_TIME) {
            IO_SET_HORN_EN(HIGH);
            counter++;
        } else {
            IO_SET_HORN_EN(LOW);
        }
    } else {
        IO_SET_HORN_EN(LOW);
        counter = 0;
    }
    
    CAN_mcu_status_horn_set(IO_GET_HORN_EN());
}

void HornControl_Halt(void) {
    IO_SET_HORN_EN(LOW);
}

/*** End of File **************************************************************/




